#!/usr/bin/env python
# -*- coding: utf-8 -*-
import sys
import os
import platform
darwin = "darwin" in platform.system().lower()
frozen = getattr(sys, 'frozen', False)
if frozen and len(sys.argv) > 1 and sys.argv[1].startswith("-psn"): # is the 'app' is opened in osx, just stars without arguments
	dirname = os.path.join(os.path.dirname(sys.argv[0]), "..", "..", "..")
	os.chdir(dirname)

if darwin and frozen: # on newer osx versions we get a lot of broken pipes when writing to stdout
	directory = os.path.expanduser("~/.vaex")
	if not os.path.exists(directory):
		os.makedirs(directory)
	sys.stdout = open(os.path.expanduser('~/.vaex/stdout.txt'), 'w')
	sys.stderr = open(os.path.expanduser('~/.vaex/stderr.txt'), 'w')

if frozen and not darwin: # pyinstaller
	os.environ["QT_API"] = "pyside" # somehow the new matplotlib under pyinstaller doesn't use pyside

import gavi.vaex.main
#print darwin, platform.system()



if __name__ == '__main__':
	#sys.stdout = open("stdout.txt", "w")
	#sys.stderr = open("stderr.txt", "w")
	#print sys.argv
	#if darwin:
	print sys.argv
	if frozen and len(sys.argv) > 1 and sys.argv[1].startswith("-psn"): # is the 'app' is opened in osx, just start without arguments
		gavi.vaex.main.main([])
	else:
		gavi.vaex.main.main(sys.argv[1:])
